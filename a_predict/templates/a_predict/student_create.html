{% extends 'a_predict/_base.html' %}
{% load static %}
{% load i18n %}
{% load partials %}
{% load slippers %}

{% block main %}
{% partialdef create_main inline=True %}
{{ info|json_script:'info' }}
<div class="pagetitle">
    <h1>{{ icon_menu|safe }} {{ title }}
        <span class="fs-6 text-secondary">{{ sub_title }}</span>
        {% if user.is_staff %}
            <a class="btn btn-sm btn-outline-primary ms-2"
               hx-target="#main" hx-swap="innerHTML swap:0.25s" hx-boost="true"
               href="">
                관리자 페이지
            </a>
        {% endif %}
    </h1>
    <nav>
        <ol class="breadcrumb" hx-target="#main" hx-swap="innerHTML swap:0.25s" hx-push-url="true">
            <li class="breadcrumb-item">
                <a href="{% url 'index' %}" hx-post="{% url 'index' %}">Home</a>
            </li>
            <li class="breadcrumb-item">
                <a class="active" href="{% url 'predict:index' %}" hx-boost="true">Predict</a>
            </li>
        </ol>
    </nav>
</div><!-- Page Title End -->

<section class="section htmx-fade-in htmx-fade-out" hx-target="#main" hx-swap="innerHTML swap:0.25s">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body text-center p-4">
                    {% if exam.exam == '프모' %}
                        <img src="{% static 'image/predict/cover_prime.jpg' %}" class="mw-100" alt="Title"/>
                        <div class="fs-1 fw-bolder">제 {{ exam.round }} 회 성적 예측</div>
                    {% else %}
                        <img src="{% static 'image/predict/cover_psat.jpg' %}" class="mw-100" alt="Title"/>
                    {% endif %}
                    {% if not student %}
                        <div class="container d-sm-none my-4">
                            <p>수험생 여러분,<br/>그 동안 수고 많으셨습니다.</p>
                            <p>여러분의 합격을<br/>기원하는 마음과 함께<br/>
                                아래와 같이 합격예측시스템을<br/>제공해드리고 있습니다.</p>
                            <p>모집단위와 직렬 및 응시번호,<br/>이름을 입력하신 뒤,<br/>
                                과목별 시험 답안을 제출해주시면<br/>집계 후 여러분의<br/>
                                합격 여부를 예측해드립니다.</p>
                        </div>
                        <div class="container d-none d-sm-block my-4">
                            <p>수험생 여러분, 그 동안 수고 많으셨습니다.</p>
                            <p>여러분의 합격을 기원하는 마음과 함께</p>
                            <p>아래와 같이 합격예측시스템을 제공해드리고 있습니다.</p>
                            <p>모집단위와 직렬 및 응시번호, 이름을 입력하신 뒤,</p>
                            <p>과목별 시험 답안을 제출해주시면 집계 후</p>
                            <p>여러분의 합격 여부를 예측해드립니다.</p>
                        </div>
                        <div class="container p-0">
                            <div class="container">
                                <img src="{% static 'image/prime/2024/exam/message-1.jpg' %}" class="mw-100" alt="Message"/>
                                <img src="{% static 'image/prime/2024/exam/message-2.jpg' %}" class="mw-100" alt="Message"/>
                            </div>
                        </div>
                    {% endif %}
                    {% if not user.is_authenticated %}
                        <a class="btn btn-outline-danger mt-4"
                           hx-target="body" hx-swap="innerHTML swap:0.25s"
                           hx-get="{% url 'account_login' %}">
                            로그인이 필요합니다.
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>

        {% if user.is_authenticated %}
            <div class="col-12">
                <div class="card">
                    <div class="card-header m-0">수험정보</div>
                    <div class="card-body p-4">
                        <div id="infoStudent" class="htmx-fade-in htmx-fade-out">
                            {% partial info_student %}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

        <div class="col-12">
            <div class="card">
                <div class="card-body p-4">
                    <div class="iframe_container">
                        <iframe class="iframe_content" title="YouTube video player"
                                src="https://www.youtube.com/embed/Fal8-8NRabY?si=4765xVgFBlV_l_Kh"
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                allowfullscreen></iframe>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endpartialdef create_main %}
{% endblock main %}

{% partialdef info_student %}
    {% if exam.is_not_page_open %}
        <div class="alert alert-danger alert-dismissible fade show mb-0" role="alert">
            <i class="fa-solid fa-circle-exclamation"></i>
                수험정보는 {{ exam.page_opened_at|date:'n/d(D) H:i' }}부터 입력 가능합니다.
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% else %}
        <div class="alert alert-danger alert-dismissible fade show mb-0" role="alert">
            <i class="fa-solid fa-circle-exclamation"></i>
                수험정보를 입력해주세요.
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>

        <form>
            <input name="password" value="0" aria-label="password" hidden/>
            <input name="id_prime_id" value="" aria-label="Prime ID" hidden/>

            <div class="row">
                <div class="col-6">
                    <select id="id_unit" class="form-select mt-3 select2-filter-style"
                            name="unit" aria-label="Select unit"
                            hx-push-url="false" hx-trigger="change"
                            hx-target="#id_department" hx-swap="outerHTML"
                            hx-post="{% url 'predict_new:department-list' %}">
                        <option value="">모집 단위를 선택해주세요.</option>
                        {% for unit in units %}
                            {% if unit == form.unit.value %}
                                <option value="{{ unit }}" selected>{{ unit }}</option>
                            {% else %}
                                <option value="{{ unit }}">{{ unit }}</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </div>
                <div class="col-6">
                    {% include 'a_predict/snippets/department_list.html' %}
                </div>
            </div>
            {{ form.errors.department }}

            <div class="form-floating mt-3">
                {{ form.serial }}
                {{ form.serial.label_tag }}
            </div>
            {{ form.errors.serial }}

            <div class="input-group mt-3">
                <div class="form-floating">
                    {{ form.name }}
                    {{ form.name.label_tag }}
                </div>
                <button class="btn btn-outline-secondary prevent_double_click" type="submit"
                        hx-target="#main"
                        hx-post="{% url 'predict_new:student-create' %}">
                    입력
                </button>
            </div>
            {{ form.errors.name }}
        </form>
        <div class="d-flex align-items-start mt-3">
            <div class="badge bg-danger me-2"><i class="fa-regular fa-circle-check"></i> 참고</div>
            <div class="text-danger small fw-bold">
                입력하신 수험정보는 변경할 수 없으니 주의하시기 바랍니다.
            </div>
        </div>
    {% endif %}
{% endpartialdef info_student %}