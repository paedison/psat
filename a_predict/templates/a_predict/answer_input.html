{% extends 'a_predict/_base.html' %}
{% load static %}

{% block main %}
{{ info|json_script:'info' }}
<div class="pagetitle">
    <h1>{{ icon_menu|safe }} {{ title }}
        <span class="fs-6 text-secondary">{{ sub_title }}</span>
    </h1>

    <nav>
        <ol class="breadcrumb" hx-target="#main" hx-swap="innerHTML swap:0.25s" hx-push-url="true">
            <li class="breadcrumb-item">
                <a href="{% url 'index' %}" hx-post="{% url 'index' %}">Home</a>
            </li>
            <li class="breadcrumb-item">
                <a href="{{ exam_vars.url_index }}" hx-boost="true">Predict</a>
            </li>
            <li class="breadcrumb-item">
                <a href="{{ exam_vars.url_detail }}" hx-boost="true">{{ exam.exam_abbr }}</a>
            </li>
            <li class="breadcrumb-item">{{ subject }}</li>
            <li class="breadcrumb-item active">
                <a class="active" href="" hx-boost="true">답안 제출</a>
            </li>
        </ol>
    </nav>
</div><!-- Page Title End -->

<section class="section htmx-fade-in htmx-fade-out" hx-target="#main" hx-swap="innerHTML swap:0.25s">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header m-0">
                    <div class="d-flex align-items-center">
                        <div>{{ icon_subject|safe }} {{ subject }} 답안 입력</div>
                        <a class="btn btn-sm btn-outline-primary ms-auto" hx-boost="true"
                           href="{{ exam_vars.url_detail }}">
                            성적 예측 페이지로 이동
                        </a>
                    </div>
                </div>
                <div class="card-body p-4">
                    <div class="col-md-6 ms-auto me-auto alert alert-danger alert-dismissible fade show" role="alert">
                        <i class="fa-solid fa-circle-exclamation"></i>
                            답안 선택 후 제출 버튼을 클릭해주세요.
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>

                    <div class="row d-flex mb-3">
                        <div class="col-6">
                            {% for answer in answer_student %}
                                {% if answer_student|length <= 30 %}
                                    {% if forloop.counter <= 15 %}
                                        {% partial form %}
                                    {% endif %}
                                {% else %}
                                    {% if forloop.counter <= 20 %}
                                        {% partial form %}
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        </div>
                        <div class="col-6">
                            {% for answer in answer_student %}
                                {% if answer_student|length <= 30 %}
                                    {% if forloop.counter > 15 %}
                                        {% partial form %}
                                    {% endif %}
                                {% else %}
                                    {% if forloop.counter > 20 %}
                                        {% partial form %}
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>

                    <div class="d-flex align-items-start justify-content-center mb-3">
                        <div>
                            <span class="badge bg-danger"><i class="fa-solid fa-triangle-exclamation"></i> 주의</span><br/>
                            <ol class="text-danger small fw-bold m-0">
                                <li>선택하신 답안은 서버에 임시 저장됩니다.</li>
                                <li>모든 문제의 답안을 선택하셔야 '답안 제출' 버튼을 클릭하실 수 있습니다.</li>
                                <li>'답안 제출' 버튼을 클릭하기 전까지는 언제든지 답안을 변경하실 수 있습니다.</li>
                                <li>'답안 제출' 버튼을 클릭하면 더 이상 답안을 변경할 수 없으니 주의하시기 바랍니다.</li>
                            </ol>
                        </div>
                    </div>
                    <form class="text-center mb-3">
                        <input type="text" name="answer_id" value="{{ answer_student.id }}" aria-label="Answer ID" hidden/>
                        <button class="btn btn-primary prevent_double_click" type="submit"
                                data-bs-toggle="modal" data-bs-target="#modalContainer"
                                hx-target="#modalContainer" hx-push-url="false" hx-swap="innerHTML"
                                hx-headers='{"answer-confirm":true}' hx-post="">
                            답안 제출
                        </button>
                    </form>
                    <div class="text-center">
                        <a class="btn btn-outline-primary" hx-boost="true"
                           href="{{ exam_vars.url_detail }}">
                            성적 예측 페이지로 이동
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock main %}

{% partialdef form %}
    <form>
        <input type="text" name="number" value="{{ answer.no }}" aria-label="Number" hidden/>
        <div class="d-flex justify-content-center py-2">
            <div class="d-inline-block fw-bold text-secondary pe-2">{{ forloop.counter|stringformat:'02d' }}.</div>
            <div id="p{{ forloop.counter|stringformat:'02d' }}_answer"
                 hx-target="this" hx-swap="innerHTML" hx-push-url="false">
                {% include 'a_predict/snippets/answer_button.html' %}
            </div>
        </div>
    </form>
{% endpartialdef form %}
