{% load slippers %}
{% load partials %}


{% startpartial no_student_modal %}
    {% #modal header='수험 정보 오류' %}
        <h5 class="modal-title mx-auto fw-bold">
            <span class="text-danger">답안을 입력하기 전에<br/>수험정보를 입력해주세요.</span>
        </h5>
    {% /modal %}
{% endpartial no_student_modal %}


{% startpartial score_confirmed %}
    {% #modal header='최종 답안 제출' %}
        <h5 class="modal-title mx-auto fw-bold">
            {% if is_confirmed == True %}
                <span class="text-success" hx-trigger="load delay:0.25s"
                    hx-get="{% url 'score_v2:list' %}?year={{ psat.year }}&ex={{ psat.exam.abbr }}" hx-target="#main"
                    hx-swap="innerHTML" hx-push-url="true">
                    답안이 정상적으로<br/>제출되었습니다.
                </span>
            {% elif is_confirmed == False %}
                <span class="text-danger">모든 문제의 답안을<br/>제출해주세요.</span>
            {% else %}
                <span class="text-danger">이미 제출한 답안은<br/>수정할 수 없습니다.</span>
            {% endif %}
        </h5>
    {% /modal %}
{% endpartial %}


{% startpartial student_create %}
    {% #modal header=header size=" " %}
        <form>
            <input id="id_year" type="text" name="year" value="{{ year }}" aria-label="Year" hidden>
            <div class="form-floating">
                <input id="id_serial" class="form-control form-control-sm"
                       type="text" placeholder="수험번호(선택사항)" name="serial"/>
                <label for="id_serial">수험번호(선택사항)</label>
            </div>
            <select id="id_unit" class="form-select mt-3" name="unit_id" aria-label="Select unit"
                    hx-post="{% url 'score_v2:student_department' %}"
                    hx-trigger="change" hx-target="#student_department">
                <option selected>모집 단위를 선택해주세요.</option>
                {% for unit in units %}
                    <option value="{{ unit.id }}">{{ unit.name }}</option>
                {% endfor %}
            </select>
            <div id="student_department" class="input-group mt-3">
            </div>
        </form>
    {% /modal %}
{% endpartial %}


{% startpartial student_department %}
    <select id="id_department" class="form-select" name="department" aria-label="Select department">
        <option selected>직렬을 선택해주세요.</option>
        {% for department in departments %}
            <option value="{{ department.id }}">
                {{ department.name }}
            </option>
        {% endfor %}
    </select>
    <button class="btn btn-outline-secondary" type="submit" data-bs-dismiss="modal"
            hx-post="{% url 'score_v2:student_create' %}" hx-target="#main">
        입력
    </button>
{% endpartial %}


{% startpartial student_update %}
    {% #modal header=header size=" " %}
        <form>
            <input id="id_year" type="text" name="year" value="{{ student.year }}"
                   aria-label="Year" hidden>
            <div class="form-floating">
                <input id="id_serial" class="form-control form-control-sm"
                       type="text" placeholder="수험번호" name="serial"
                       value="{{ student.serial|default:'' }}"/>
                <label for="id_serial">수험번호(선택사항)</label>
            </div>
            <select id="id_unit" class="form-select mt-3" name="unit" aria-label="Select unit"
                    hx-get="{% url 'score_v2:student_department' %}"
                    hx-trigger="change" hx-target="#student_department">
                <option selected>모집 단위를 선택해주세요.</option>
                {% for unit in units %}
                    <option value="{{ unit.id }}"
                            {% if unit == student.department.unit %}selected{% endif %}>
                        {{ unit.name }}
                    </option>
                {% endfor %}
            </select>
            <div id="student_department" class="input-group mt-3">
                <select id="id_department" class="form-select" name="department" aria-label="Select department">
                    <option selected>직렬을 선택해주세요.</option>
                    {% for department in departments %}
                        <option value="{{ department.id }}"
                                {% if department == student.department %}selected{% endif %}>
                            {{ department.name }}
                        </option>
                    {% endfor %}
                </select>
                <button class="btn btn-outline-secondary" type="submit" data-bs-dismiss="modal"
                        hx-post="{% url 'score_v2:student_update' student.id %}" hx-target="#main">
                    수정
                </button>
            </div>
        </form>
    {% /modal %}
{% endpartial %}
