{% extends 'list.html' %}
{% load static %}
{% load i18n %}
{% load psat_filter %}
{% load partials %}
{% load slippers %}

{% block head_title %}{{ title }}{% endblock head_title %}

{% block main %}{% partial list_main %}{% endblock %}

{# List main partial #}
{% startpartial list_main %}
    {{ info|json_script:'info' }}
    <div class="pagetitle my-2">
        <h1>{{ icon|safe }} {{ title }}
            <span class="fs-6 text-bg-primary">{{ sub_title }}</span>
        </h1>
    </div><!-- Page Title End -->
    {% partial list_content %}
{% endpartial list_main %}


{# ################## #}
{# List content start #}
{# ################## #}

{# List content partial #}
{% startpartial list_content %}
    <section class="section htmx-fade-in htmx-fade-out"
             hx-target="#main" hx-swap="innerHTML swap:0.25s">
    {% #content_row class3='p-4' %}
        <div class="mb-4">
            <div class="ms-auto col-sm-6 col-md-5 col-lg-4">
                {% partial exam_filter %}
            </div>
        </div>
        <div class="mb-4">
            {% partial student_info %}
        </div>
        <div class="mb-4">
            {% include 'score/v2/snippets/score_chart.html' %}
        </div>
        <div class="mb-4">
            {% include 'score/v2/snippets/score_sheet.html' %}
        </div>
        <div class="mb-4">
            {% include 'score/v2/snippets/score_answers.html' %}
        </div>
    {% /content_row %}
    </section>
{% endpartial %}


{# ################## #}
{# Student info start #}
{# ################## #}

{# Student info partial #}
{% startpartial student_info %}
    <nav>
        <div class="nav nav-tabs" id="studentInfoTab" role="tablist">
            {% #nav_tab prefix='my' id='0' %}
                수험정보
            {% /nav_tab %}
        </div>
    </nav>
    <div class="tab-content" id="studentInfoContent">
        {% #nav_content prefix='info' id='0' %}
            {% #responsive_table %}
                <tbody>
                    <tr>
                        <td>
                            응시번호
                            {% if student.serial %}
                                : {{ student.serial }} {% partial update_student %}
                            {% else %}
                                {% partial create_student %}
                            {% endif %}
                        </td>
                        <td>
                            모집단위
                            {% if student.department %}
                                : {{ student.department.unit.name }} {% partial update_student %}
                            {% else %}
                                {% partial create_student %}
                            {% endif %}
                        </td>
                        <td>
                            응시직렬
                            {% if student.department %}
                                : {{ student.department.name }} {% partial update_student %}
                            {% else %}
                                {% partial create_student %}
                            {% endif %}
                        </td>
                    </tr>
                </tbody>
{#                <tbody>#}
{#                    <tr>#}
{#                        <th scope="row">#}
{#                            응시번호#}
{#                            {% if student.serial %}#}
{#                                {% partial update_student %}#}
{#                            {% else %}#}
{#                                {% partial create_student %}#}
{#                            {% endif %}#}
{#                        </th>#}
{#                        <td>{{ student.serial }}</td>#}
{#                    </tr>#}
{#                    <tr>#}
{#                        <th scope="row">#}
{#                            모집단위#}
{#                            {% if student.department %}#}
{#                                {% partial update_student %}#}
{#                            {% else %}#}
{#                                {% partial create_student %}#}
{#                            {% endif %}#}
{#                        </th>#}
{#                        <td>{{ student.department.unit.name }}</td>#}
{#                    </tr>#}
{#                    <tr>#}
{#                        <th scope="row">#}
{#                            응시직렬#}
{#                            {% if student.department %}#}
{#                                {% partial update_student %}#}
{#                            {% else %}#}
{#                                {% partial create_student %}#}
{#                            {% endif %}#}
{#                        </th>#}
{#                        <td>{{ student.department.name }}</td>#}
{#                    </tr>#}
{#                </tbody>#}
            {% /responsive_table %}
        {% /nav_content %}
    </div>
{% endpartial student_info %}

{# Update student partial #}
{% startpartial update_student %}
    <a class="badge rounded-pill text-bg-warning"
       hx-get="{% url 'score_v2:student_update_modal' student.id %}" href=""
       hx-target="#modalContainer" hx-swap="innerHTML"
       data-bs-toggle="modal" data-bs-target="#modalContainer">
        수정
    </a>
{% endpartial %}

{# Create student partial #}
{% startpartial create_student %}
    <a class="badge rounded-pill text-bg-warning mx-2"
       hx-get="{% url 'score_v2:student_create_modal' year ex %}" href=""
       hx-target="#modalContainer" hx-swap="innerHTML"
       data-bs-toggle="modal" data-bs-target="#modalContainer">
        입력
    </a>
{% endpartial %}


{# ############ #}
{# Filter start #}
{# ############ #}

{# Exam filter partial #}
{% startpartial exam_filter %}
    <form>
        <div class="input-group">
            <select id="id_exam_year" class="form-select" name="year" aria-label="Select Year"
                    hx-post="{% url 'score_v2:filter' %}"
                    hx-trigger="change" hx-target="#id_exam_name" hx-swap="outerHTML">
                <option>연도</option>
                {% for y in year_option %}
                    <option value="{{ y.0 }}"{% if y.0 == year %} selected{% endif %}>
                        {{ y.1 }}
                    </option>
                {% endfor %}
            </select>
            {% partial exam_select %}
        </div>
    </form>
{% endpartial exam_filter %}

{# Exam select partial #}
{% startpartial exam_select %}
    <select id="id_exam_name" class="form-select" name="ex" aria-label="Select Year"
            hx-post="{% url 'score_v2:list' %}"
            hx-trigger="change" hx-target="#main">
        {% for e in ex_option %}
            <option value="{{ e.0 }}"{% if e.0 == ex %} selected{% endif %}>
                {{ e.1 }}
            </option>
        {% endfor %}
    </select>
{% endpartial exam_select %}
