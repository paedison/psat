{% load i18n %}
{% load taggit_templatetags2_tags %}
{% load partials %}
{% load psat_filter %}

{% startpartial tag_list %}
    <span class="badge rounded-pill bg-primary dropdown-toggle"
          type="button" data-bs-toggle="dropdown"
          aria-expanded="false">{{ tag }}</span>
{% endpartial %}

{% startpartial tag_cloud %}
    <button class="dropdown-item" title="{% trans 'Tag Cloud' %}" href="#">
        <i class="fa-solid fa-tag"></i>{% trans 'Tag Cloud' %}
    </button>
{% endpartial %}

{% startpartial my_list %}
    {% get_sorted_tags_for_object my_tag as "tags" %}
    {% for tag in tags %}
        <div class="btn-group">
            {% partial tag_list %}
            <ul class="dropdown-menu">
                <li>{% partial tag_cloud %}</li>
                <li>
                    <button class="dropdown-item" title="{% trans 'Delete Tag' %}"
                            hx-post="{% url 'psat:tag_delete' my_tag.id tag.name %}"
                            hx-confirm="{% trans 'Are you sure you wish to delete your tag?' %}"
                            hx-target="#detailTags" hx-swap="innerHTML" href="">
                        <i class="fa-solid fa-xmark"></i>{% trans 'Delete Tag' %}
                    </button>
                </li>
            </ul>
        </div>
    {% endfor %}
{% endpartial %}

{% startpartial all_list %}
    {% for tag in all_tag %}
    <div class="btn-group">
        {% partial tag_list %}
        <ul class="dropdown-menu">
            <li>{% partial tag_cloud %}</li>
            {% if not my_tag_list or tag not in my_tag_list %}
            <li>
                <form>
                    <div class="input-group">
                        <input name="tags" type="text" value="{{ tag }}"
                               class="form-control form-control-sm"
                               placeholder="{% trans 'Leave tags' %}"
                               aria-label="Tag input" hidden/>
                        {% if not my_tag_list %}
                        <button class="dropdown-item" href="" hx-include=".tag-info"
                                hx-post="{% url 'psat:tag_create' %}"
                                hx-target="#detailTags" hx-swap="innerHTML">
                            <i class="fa-solid fa-plus"></i>
                            {% trans 'Add to my tags' %}
                        </button>
                        {% elif my_tag_list and tag not in my_tag_list %}
                        <button class="dropdown-item" href="" hx-include=".tag-info"
                                hx-post="{% url 'psat:tag_add' my_tag.id %}"
                                hx-target="#detailTags" hx-swap="innerHTML">
                            <i class="fa-solid fa-plus"></i>
                            {% trans 'Add to my tags' %}
                        </button>
                        {% endif %}
                    </div>
                </form>
            </li><!-- Add to My Tags End -->
            {% endif %}
        </ul>
    </div>
    {% endfor %}
{% endpartial %}

<div id="detailTags">
    <div id="myTags">
        <div class="badge bg-success m-2">MY TAGS</div>
        <div class="mb-2 mx-2">
            <form>
                <input name="user" type="text" class="tag-info"
                       value="{{ user.id }}" aria-label="User" hidden/>
                <input name="problem" type="text" class="tag-info"
                       value="{{ problem.prob_id }}" aria-label="Problem" hidden/>
                <div class="input-group">
                    <input name="tags" type="text" aria-label="Tag input" required
                           class="form-control form-control-sm"
                           placeholder="{% trans 'Leave tags' %}"/>
                    {% if my_tag %}
                        <button class="btn btn-sm btn-outline-primary" href=""
                                hx-post="{% url 'psat:tag_add' my_tag.id %}"
                                hx-include=".tag-info" hx-target="#detailTags"
                                hx-swap="innerHTML">
                            {% trans 'Add' %}
                        </button>
                    {% else %}
                        <button class="btn btn-sm btn-outline-primary" href=""
                                hx-post="{% url 'psat:tag_create' %}"
                                hx-include=".tag-info" hx-target="#detailTags"
                                hx-swap="innerHTML">
                            {% trans 'Create' %}
                        </button>
                    {% endif %}
                </div>
            </form>
        </div>
        {% if my_tag %}
        <div class="d-flex align-items-start mb-2 mx-2">
            <div class="border-start border-secondary-subtle ps-2">
                {% partial my_list %}
            </div>
        </div>
        {% endif %}
    </div><!-- My Tags End -->

    <div id="allTags">
        <div class="badge bg-success m-2">ALL TAGS</div>
        {% if all_tag %}
        <div class="d-flex align-items-start mb-2 mx-2">
            <div class="border-start border-secondary-subtle ps-2">
                {% partial all_list %}
            </div>
        </div>
        {% endif %}
    </div><!-- All Tags End -->
</div>