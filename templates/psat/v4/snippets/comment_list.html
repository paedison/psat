{% extends 'list.html' %}
{% load static %}
{% load i18n %}
{% load slippers %}
{% load partials %}
{% load psat_filter %}
{% load crispy_forms_tags %}

{% block main %}
{% partialdef list_main inline=True %} {# list_main partial #}
{% #responsive_table %}
    <tbody>
        {% if page_obj %}
            {% for comment in page_obj %}
                <tr>
                    <td class="text-nowrap p-2 col-1">
                        <a class="text-decoration-none fw-bold" hx-target="#modalContainer"
                           hx-swap="innerHTML swap:0.25s" href=""
                           hx-get="{% url 'psat:detail_image' comment.problem_id %}"
                           data-bs-toggle="modal" data-bs-target="#modalContainer">
                            {{ comment.year }}{{ comment.ex|first }}{{ comment.sub|first }}-{{ comment.number|stringformat:'02d' }}
                        </a>
                    </td>
                    <td class="text-nowrap p-2">
                        <a class="text-decoration-none fw-bold text-secondary" hx-boost="true"
                           hx-swap="innerHTML swap:0.25s" hx-target="#main" hx-push-url="true"
                           href="{% url 'psat:comment_detail' comment.id %}">
                            {% if comment.parent %}
                                <span class="text-primary">{{ icon_board.reply|safe }}</span>
                            {% endif %}
                            {{ comment.title }}
                        </a>
                    </td>
                    <td class="text-nowrap text-end p-2">
                        {% with username=comment.username target_user=comment.user %}
                            {% include 'psat/v4/snippets/username.html' %}
                        {% endwith %}
                        <span class="small text-secondary ms-1">
                            {{ comment.timestamp|date:'n/j(D) G:i' }}
                        </span>
                    </td>
                </tr>
            {% endfor %}
        {% else %}
            <tr>
                <td class="text-center text-nowrap px-2" colspan="5">자료가 없습니다.</td>
            </tr>
        {% endif %}
    </tbody>
{% /responsive_table %}

{% #pagination_nav %}
    {% if page_obj.has_previous %}
        {% with page_num=page_obj.number|add:-1 chevron='left' %}
            {% partialdef pagination_link inline=True %}
                <li class="page-item {{ status }}"
                    {% if status == 'active' %}aria-current="page"{% endif %}>
                    <a class="page-link" href=""
                        {% if status == 'disabled' %}
                            tabindex="-1" aria-disabled="true"
                        {% else %}
                            hx-get="{% url 'psat:comment_list' %}?page={{ page_num }}"
                        {% endif %}>
                        {% if chevron %}
                            <i class="fa-solid fa-chevron-{{ chevron }}"></i>
                        {% else %}
                            {{ anchor_text }}
                        {% endif %}
                    </a>
                </li>
            {% endpartialdef pagination_link %}
        {% endwith %}
    {% endif %}

    {% for number in page_range %}
        {% with page_num=number anchor_text=number %}
            {% if number == page_obj.number %}
                {% with status='active' %}
                    {% partial pagination_link %}
                {% endwith %}
            {% elif number == page_obj.paginator.ELLIPSIS %}
                {% with status='disabled' %}
                    {% partial pagination_link %}
                {% endwith %}
            {% else %}
                {% partial pagination_link %}
            {% endif %}
        {% endwith %}
    {% endfor %}

    {% if page_obj.has_next %}
        {% with page_num=page_obj.number|add:1 chevron='right' %}
            {% partial pagination_link %}
        {% endwith %}
    {% endif %}
{% /pagination_nav %}
{% endpartialdef list_main %}
{% endblock main %}
